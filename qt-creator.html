<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it-IT" xml:lang="it-IT">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc-markdown-css-theme" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Maurizio Tomasi" />
  <title>Usare Qt Creator</title>
  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/skylighting-solarized-theme.css" />
  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
  <script src="./fmtinstall.js"></script>
</head>
<body>

<header>
<h1 class="title">Usare Qt Creator</h1>
<blockquote class="metadata">
<p class="author">
      Maurizio Tomasi
  </p>
</blockquote>
</header>

<nav id="TOC" role="doc-toc">
    <strong>Contents</strong><label for="contents">⊕</label>
  <input type="checkbox" id="contents">
  <ul>
  <li><a href="#come-usare-qt-creator" id="toc-come-usare-qt-creator">Come usare Qt Creator</a></li>
  <li><a href="#compilare-ed-eseguire-il-programma" id="toc-compilare-ed-eseguire-il-programma">Compilare ed eseguire il programma</a></li>
  <li><a href="#aggiungere-altri-file-al-progetto" id="toc-aggiungere-altri-file-al-progetto">Aggiungere altri file al progetto</a></li>
  <li><a href="#parametri-da-linea-di-comando" id="toc-parametri-da-linea-di-comando">Parametri da linea di comando</a></li>
  <li><a href="#refactoring" id="toc-refactoring">Refactoring</a></li>
  <li><a href="#debugging" id="toc-debugging">Debugging</a></li>
  <li><a href="#usare-root-con-qt-creator" id="toc-usare-root-con-qt-creator">Usare ROOT con Qt Creator</a></li>
  <li><a href="#usare-gplot-con-qt-creator" id="toc-usare-gplot-con-qt-creator">Usare gplot++ con Qt Creator</a></li>
  <li><a href="#e-i-makefile" id="toc-e-i-makefile">E i Makefile?</a></li>
  </ul>
</nav>

<main>
<p>Qt Creator è un’Integrated Development Environment (IDE) per il C++, sviluppato dalla compagnia norvegese Trolltech. È un sistema semplice ma potente che integra le funzionalità di diversi programmi:</p>
<ul>
<li><p>Un editor, come Visual Studio Code;</p></li>
<li><p>Un compilatore C++, come <code>g++</code> o <code>clang++</code>;</p></li>
<li><p>Sistemi di <em>build</em> come <code>make</code> e CMake;</p></li>
<li><p>Un debugger, come <code>gdb</code>;</p></li>
<li><p>Un programma per formattare automaticamente il codice, come <code>clang-format</code>;</p></li>
<li><p>Una finestra di terminale da cui eseguire i propri programmi.</p></li>
</ul>
<p>Il nome IDE deriva proprio dal rendere tutte queste potenzialità disponibili nel medesimo ambiente.</p>
<h1 id="come-usare-qt-creator">Come usare Qt Creator</h1>
<p>Di default, Qt Creator crea un progetto che usa le librerie Qt, il prodotto più famoso dell’azienda Trolltech. (Potete vederla come una libreria analoga a ROOT per dimensioni e complessità, che consente di sviluppare applicazioni grafiche per desktop e per dispositivi mobili come smartphone e tablet).</p>
<p>A noi <strong>non</strong> interessa però sviluppare con le librerie Qt, e avremo bisogno di impostazioni diverse da quelle di default, quindi per creare un nuovo progetto seguite queste istruzioni:</p>
<ol type="1">
<li><p>Appena si apre la finestra principale, vi verrà proposto di creare un “Progetto”. Per progetto si intende una collezione di file C++, di header, e di makefile che servono per compilare un eseguibile. Dovrete quindi creare un progetto separato per ogni esercizio che farete. Selezionate dalla pagina principale il grande bottone verde <em>Create new project…</em>:</p>
<p><img src="images/qtcreator-splash-screen.png" /></p></li>
<li><p>Vi verrà chiesto che tipo di progetto creare. <strong>Non dovete scegliere il default</strong>, che prevede di usare le librerie Qt! Scegliete invece dal menu <em>Non-Qt project</em> la voce <em>Plain C++ Application</em>, come mostrato in figura:</p>
<p><img src="images/qtcreator-new-project.png" /></p></li>
<li><p>Dovete ora specificare la cartella in cui tutti i file del progetto saranno salvati. Vi consiglio una cartella con il numero dell’esercizio scritto esplicitamente, come ad esempio <code>esercizio40</code> (purtroppo non potete usare il punto, quindi <code>esercizio4.0</code> non va bene):</p>
<p><img src="images/qtcreator-project-location.png" /></p>
<p>Se selezionate la voce <em>Use as default project location</em>, tutte le directory con i nuovi progetti che creerete saranno salvate sotto quella indicata alla voce <em>Create in:</em> (nell’immagine sopra è <code>/home/tomasi/eserciziTNDS</code>). È <strong>molto</strong> consigliato!</p></li>
<li><p>Lasciate tutte le altre voci inalterate e concludete la creazione del progetto. Vedrete che il programma aprirà il file contenente la funzione <code>main()</code>:</p>
<p><img src="images/qtcreator-project.png" /></p></li>
<li><p>Purtroppo la versione corrente di Qt Creator usa di default il linguaggio C++17, che è un po’ troppo vecchio. Cambiate la versione modificando il file <code>CMakeLists.txt</code>: è sufficiente fare doppio click su di esso nel pannello in alto a sinistra per aprirlo. Cambiate da <code>17</code> a <code>20</code> il valore nella riga 5 che contiene il testo <code>set(CMAKE_CXX_STANDARD 17)</code>, e lasciate tutto il resto inalterato:</p>
<p><img src="images/qtcreator-cxx-version.png" /></p></li>
</ol>
<p>A questo punto il progetto è configurato, e potete iniziare a scrivere il codice! Quando volete salvare il file che state editando, premete <code>Ctrl+S</code>.</p>
<p>La pressione di <code>Ctrl+S</code> esegue una formattazione automatica del codice, aggiustando i rientri e le spaziature in modo automatico. È equivalente ad eseguire da terminale il comando</p>
<pre><code>clang-format -i NOMEFILE.cpp</code></pre>
<h1 id="compilare-ed-eseguire-il-programma">Compilare ed eseguire il programma</h1>
<p>Qt Creator prevede la comoda scorciatoia da tastiera <code>Ctrl+R</code> per eseguire queste azioni:</p>
<ol type="1">
<li><p>Salva tutti i file ancora non salvati;</p></li>
<li><p>Compila il programma;</p></li>
<li><p>Mostra gli errori di compilazione in caso la compilazione sia fallita;</p></li>
<li><p>Esegue il programma in caso di successo, mostrando l’output nel pannello inferiore.</p></li>
</ol>
<p>Questo è il risultato di premere <code>Ctrl+R</code> nel semplice programma generato automaticamente da Qt Creator:</p>
<p><img src="images/qtcreator-run.png" /></p>
<p>La combinazione <code>Ctrl+R</code> è forse la scorciatoia da tastiera <strong>più importante</strong>, e quella che vi risparmierà molto tempo nello sviluppo!</p>
<p>Se ci fosse un errore nel codice, ad esempio perché abbiamo dimenticato il punto e virgola <code>;</code> alla fine della riga del <code>cout</code>, questo è ciò che vedremmo:</p>
<p><img src="images/qtcreator-error.png" /></p>
<p>Non solo l’editor mostra l’errore sotto la riga incriminata, ma il pannello inferiore contiene una lista completa di ogni errore. Facendo click su uno di essi, l’editor si porta sulla riga incriminata per poterla modificare immediatamente.</p>
<h1 id="aggiungere-altri-file-al-progetto">Aggiungere altri file al progetto</h1>
<p>Difficilmente il vostro esercizio sarà contenuto in un solo file. Per aggiungere un nuovo file <code>.h</code> o <code>.cpp</code> al progetto, fate click col tasto destro sull’elemento <em>Source files</em> nell’albero delle directory a sinistra:</p>
<p><img src="images/qtcreator-add-new-file.png" /></p>
<p>Scegliete la voce <em>Add new…</em> e selezionate se volete un file header (<code>.h</code>) o C++ (<code>.cpp</code>):</p>
<p><img src="images/qtcreator-add-c++.png" /></p>
<p>Indicate il nome del file, e se è un file <code>.cpp</code> vedrete che viene automaticamente aggiunto in <code>CMakeLists.txt</code>, come si vede in questo esempio dove il nome del nuovo file è <code>funzioni.cpp</code>:</p>
<p><img src="images/qtcreator-file-added.png" /></p>
<p>Questo significa che quando premerete <code>Ctrl+R</code> per compilare ed eseguire il programma, questo verrà incluso nella compilazione.</p>
<h1 id="parametri-da-linea-di-comando">Parametri da linea di comando</h1>
<p>Molti esercizi di TNDS richiedono di passare parametri dalla linea di comando. Per informare il comando <code>Ctrl+R</code> di passare parametri aggiuntivi, occorre selezionare dalla barra scura a sinistra la voce “Project” e scegliere la voce “Run”. Inserite gli argomenti nella voce <em>Command line arguments</em>, come mostrato in figura:</p>
<p><img src="images/qtcreator-set-arguments.png" /></p>
<p>Digitando <code>argument1 argument2</code>, l’output di un programma che stampa il valore di <code>argv</code> è il seguente:</p>
<p><img src="images/qtcreator-run-with-arguments.png" /></p>
<p>Notate che il valore di <code>argv[0]</code>, che contiene l’eseguibile, indica che la directory in cui è stato salvato l’eseguibile <strong>non</strong> è quella in cui sono salvati i file sorgente, ma è la sottodirectory <code>build/Desktop-Debug/</code>. Qt Creator funziona in questo modo per tenere separati i file generati dal compilatore e i file che compongono il codice sorgente del vostro programma: in <code>build/Desktop-Debug/</code> sono salvati anche tutti i file <code>*.o</code>, e quindi per “ripulire” la directory come se si facesse <code>make clean</code> è sufficiente cancellare la directory <code>build</code>.</p>
<h1 id="refactoring">Refactoring</h1>
<p>Col termine <em>refactoring</em> si intende la modifica del codice in modo da renderlo più leggibile.</p>
<p>Immaginiamo un programma minimamente complicato, che prenda in input un vettore di elementi <span class="math inline">v_i</span> e debba calcolare la quantità <span class="math display">
Q = \frac1{N}\sum_{i=1}^N \bigl(3 v_i + \sin(v_i)\bigr)^2.
</span></p>
<p>Definiamo quindi una funzione <code>f(x)</code> che calcoli il valore del termine nella somma:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> f<span class="op">(</span><span class="dt">double</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> pippo<span class="op">{</span>x <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> sin<span class="op">(</span>x<span class="op">)};</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pippo <span class="op">*</span> pippo<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>dove abbiamo chiamato la variabile <code>pippo</code> perché non ci è venuto in mente un termine migliore. Implementiamo poi il <code>main</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span> argv<span class="op">[])</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    vector v<span class="op">{</span><span class="fl">5.4</span><span class="op">,</span> <span class="fl">3.7</span><span class="op">,</span> <span class="fl">6.9</span><span class="op">,</span> <span class="fl">4.4</span><span class="op">,</span> <span class="fl">3.7</span><span class="op">,</span> <span class="fl">6.1</span><span class="op">};</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> pippo<span class="op">{};</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">{};</span> i <span class="op">&lt;</span> ssize<span class="op">(</span>v<span class="op">);</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        pippo <span class="op">+=</span> f<span class="op">(</span>v<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    pippo <span class="op">/=</span> ssize<span class="op">(</span>v<span class="op">);</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> format<span class="op">(</span><span class="st">&quot;Q = </span><span class="sc">{:.1f}</span><span class="st"> for </span><span class="sc">{}</span><span class="st"> samples</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> pippo<span class="op">,</span> ssize<span class="op">(</span>v<span class="op">));</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Ancora una volta, per la fretta chiamate la variabile <code>pippo</code>. Il programma funziona e stampa il valore di <code>Q</code>:</p>
<p><img src="images/qtcreator-before-refactoring.png" /></p>
<p>Però non vorreste consegnare un codice scritto così, con le variabili tutte chiamate <code>pippo</code>. Ma d’altra parte non potete usare la funzione <em>Edit | Find/Replace</em> (tasto <code>Ctrl+F</code>), perché vorreste usare un nome diverso per la variabile <code>pippo</code> nella funzione <code>f()</code> e per <code>pippo</code> nel <code>main()</code>.</p>
<p>Gli strumenti di <em>refactoring</em> fanno esattamente al caso vostro: è sufficiente spostarsi con il cursore sul nome della variabile o funzione da rinominare e premere <code>Ctrl+Shift+R</code> per modificare al volo solo quell’istanza. Nel caso di funzioni o metodi di classi, Qt Creator cambierà tutte le corrispondenze <strong>nell’intero progetto</strong>, anche se sono in file <code>.cpp</code> o <code>.h</code> separati. Questo video mostra la combinazione <code>Ctrl+Shift+R</code> applicata al nostro esempio:</p>
<video controls>
<source src="media/qtcreator-refactor.webm" type="video/webm; codecs=vp9,vorbis">
<source src="media/qtcreator-refactor.mp4" type="video/mp4">
</video>
<h1 id="debugging">Debugging</h1>
<p>Qt Creator consente di eseguire i programmi in modalità <em>debugging</em>, per monitorarne l’esecuzione.</p>
<p>Eseguire un programma in modalità <em>debugging</em> permette ad esempio di arrestarne l’esecuzione quando arriva a una certa riga, eseguire il programma una riga alla volta, ispezionare ed addirittura modificare il valore delle variabili!</p>
<p>Il modo più semplice per usare la modalità debugging è di fare click con il mouse immediatamente a sinistra del numero della riga da fermare. In questo esempio ho fatto click accanto alla riga #17, ed è apparso un cerchio rosso che indica l’esistenza di un <em>breakpoint</em> (si può far apparire o scomparire il <em>breakpoint</em> anche premendo il tasto <code>F9</code>):</p>
<p><img src="images/qtcreator-breakpoint.png" /></p>
<p>A questo punto, premendo <code>F5</code> o scegliendo dal menu <em>Debug</em> la voce <em>Start debugging</em>, il programma sarà compilato ed eseguito, ma l’esecuzione verrà arrestata appena il programma sta per eseguire la riga 17:</p>
<p><img src="images/qtcreator-frozen.png" /></p>
<p>Il programma è stato “congelato” appena prima che potesse eseguire la riga</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> accum<span class="op">{};</span></span></code></pre></div>
<p>È comparso un pannello in alto a destra che mostra che la variabile <code>accum</code> è già stata allocata, ma non è ancora stata inizializzata a zero: infatti il suo valore è un numero casuale (<code>6.9533…</code>). Possiamo vedere anche che <code>argc</code> vale <code>1</code>, e facendo click sul simbolo <code>&gt;</code> a sinistra di <code>argv</code> e di <code>v</code> ispezionare gli elementi dei due vettori.</p>
<p>Il programma può essere fatto uscire dalla sua condizione “congelata” in vari modi:</p>
<ul>
<li><p>Il tasto <code>F5</code> fa riprendere l’esecuzione normalmente, fino al <em>breakpint</em> successivo (se c’è) o fino alla fine naturale del programma (voce <em>Continue</em> del menu <em>Debug</em>)</p></li>
<li><p>Il tasto <code>F10</code> esegue la riga corrente e va alla prossima (voce <em>Step over</em>);</p></li>
<li><p>Il tasto <code>F11</code> è come il tasto <code>F10</code>, ma se la riga corrente contiene l’invocazione a una funzione, come ad esempio <code>inner_function</code>, l’esecuzione “entra” nella funzione e si ferma lì (voce <em>Step into</em>);</p></li>
<li><p>Il tasto <code>Shift+F11</code> esegue la funzione in cui ci si trova finché questa non termina, poi congela di nuovo il programma (voce <em>Step out</em>);</p></li>
<li><p>Posizionandosi su una linea arbitraria e premendo <code>Ctrl+F10</code>, il programma riprende l’esecuzione finché non raggiunge quella linea (voce <em>Run to line</em>); equivale all’impostazione di un <em>breakpoint</em> “temporaneo”.</p></li>
</ul>
<p>Esistono molte funzionalità più avanzate per fare <em>debugging</em>; ve ne elenco alcune:</p>
<ul>
<li><p>È possibile modificare il valore di una variabile facendo doppio click sul suo nome nel pannello più a destra;</p></li>
<li><p>Facendo click col tasto destro sul simbolo rosso di un <em>breakpoint</em>, è possibile impostare condizioni per stabilire quando deve essere eseguito;</p></li>
<li><p>È possibile aggiungere espressioni complesse (ad esempio, <code>2 * accum + v[0]</code>), il cui risultato verrà stampato ogni volta che il programma si ferma.</p></li>
</ul>
<h1 id="usare-root-con-qt-creator">Usare ROOT con Qt Creator</h1>
<p>Se il vostro programma usa ROOT, dovete modificare il file <code>CMakeLists.txt</code> aggiungendo prima della riga <code>add_executable(…)</code> la riga seguente:</p>
<pre><code>find_package(ROOT REQUIRED)</code></pre>
<p>che dice a CMake che il vostro programma non può essere compilato se non è installata la libreria ROOT, e in fondo al file</p>
<pre><code>target_link_libraries(esercizioXXX ${ROOT_LIBRARIES})</code></pre>
<p>che dice che l’eseguibile <code>esercizioXXX</code> (il nome deve essere lo stesso dentro la parentesi dopo <code>add_executable</code>) va compilato insieme alle librerie ROOT.</p>
<p>Ad esempio, la riga</p>
<pre><code>add_executable(esercizio40 main.cpp funzioni.cpp)</code></pre>
<p>deve diventare</p>
<pre><code>find_package(ROOT REQUIRED)
add_executable(esercizio40 main.cpp funzioni.cpp)
target_link_libraries(main ${ROOT_LIBRARIES})</code></pre>
<h1 id="usare-gplot-con-qt-creator">Usare gplot++ con Qt Creator</h1>
<p>Basta copiare il file <code>gplot++.h</code> nella cartella del progetto. Non è necessario aggiornare <code>CMakeLists.txt</code>, perché la libreria consiste solo del file header.</p>
<h1 id="e-i-makefile">E i Makefile?</h1>
<p>Qt Creator <strong>non</strong> usa il programma <code>make</code>; di default usa <a href="https://ninja-build.org/">Ninja</a>, che è una versione più moderna di <code>make</code> (soprattutto, è molto più efficiente!).</p>
<p>Se l’eseguibile <code>ninja</code> non è presente, Qt Creator dovrebbe essere in grado di appoggiarsi a <code>make</code>.</p>
</main>

<script>
;(function() {
  // Non-essential if user has JavaScript off. Just makes checkboxes look nicer.
  var selector = '.task-list > li > input[type="checkbox"]';
  var checkboxes = document.querySelectorAll(selector);
  Array.from(checkboxes).forEach((checkbox) => {
    var wasChecked = checkbox.checked;
    checkbox.disabled = false;
    checkbox.addEventListener('click', (ev) => {ev.target.checked = wasChecked});
  });
})();
</script>
</body>
</html>
